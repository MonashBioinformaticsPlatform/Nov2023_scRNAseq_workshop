[{"path":"index.html","id":"about","chapter":"1 About","heading":"1 About","text":"Material scRNAseq analysis R Seurat workshop.workshop follows introductory Guided Clustering Tutorial tutorial Seurat.also drawing similar workshop held Monash Bioinformatics Platform Single-Cell-Workshop, material \n","code":""},{"path":"welcome.html","id":"welcome","chapter":"2 Welcome","heading":"2 Welcome","text":"Seesion information ","code":""},{"path":"schedule.html","id":"schedule","chapter":"3 Schedule","heading":"3 Schedule","text":"Timetable goes .","code":""},{"path":"schedule.html","id":"day-1","chapter":"3 Schedule","heading":"3.1 Day 1","text":"Stuff","code":""},{"path":"schedule.html","id":"day-2","chapter":"3 Schedule","heading":"3.2 Day 2","text":"","code":""},{"path":"overview.html","id":"overview","chapter":"4 Overview","heading":"4 Overview","text":"Discuss background single cell analysis.(slides)","code":""},{"path":"seuratobject.html","id":"seuratobject","chapter":"5 The Seurat object","heading":"5 The Seurat object","text":"todays workshop following Seurat PBMC tutorial (reproduced next section).\n’ll load raw counts data, QC setup various useful information Seurat object.- Seurat object look like, can ’ve made one?Lets look Seurat object ’s already setup.","code":""},{"path":"seuratobject.html","id":"load-an-existing-seurat-object","chapter":"5 The Seurat object","heading":"5.1 Load an existing Seurat object","text":"data ’re working today small dataset 3000 PBMCs (peripheral blood mononuclear cells) healthy doner.early demo dataset 10X genomics (called pbmc3k) - can find information like qc reports .First, load Seurat package.’s one prepared earlier. Seurat objects usually saved ‘.rds’ files, R format storing binary data (-text human-readable). functions readRDS() can load .","code":"\nlibrary(Seurat)\npbmc_processed <- readRDS(\"data/pbmc_tutorial.rds\")\npbmc_processed\n#> An object of class Seurat \n#> 13714 features across 2700 samples within 1 assay \n#> Active assay: RNA (13714 features, 2000 variable features)\n#>  2 dimensional reductions calculated: pca, umap"},{"path":"seuratobject.html","id":"whats-in-there","chapter":"5 The Seurat object","heading":"5.2 What’s in there?","text":"important information working Seurat objects metadata.\ncell level information - row one cell, identified barcode.\nExtra information gets added table analysis progresses.doesn’t gene expression though, ’s stored ‘Assay’.\nAssay structure nuances (see discussion ), functions get assay data .default object return normalised data (assay object, called RNA). Every ‘.’ zero.raw counts data accessible .Seurat generally hides alot data complexity, provides functions typical tasks. Like plotting.","code":"\nhead(pbmc_processed@meta.data)\n#>                  orig.ident nCount_RNA nFeature_RNA\n#> AAACATACAACCAC-1     pbmc3k       2419          779\n#> AAACATTGAGCTAC-1     pbmc3k       4903         1352\n#> AAACATTGATCAGC-1     pbmc3k       3147         1129\n#> AAACCGTGCTTCCG-1     pbmc3k       2639          960\n#> AAACCGTGTATGCG-1     pbmc3k        980          521\n#> AAACGCACTGGTAC-1     pbmc3k       2163          781\n#>                  percent.mt RNA_snn_res.0.5 seurat_clusters\n#> AAACATACAACCAC-1  3.0177759               0               0\n#> AAACATTGAGCTAC-1  3.7935958               3               3\n#> AAACATTGATCAGC-1  0.8897363               2               2\n#> AAACCGTGCTTCCG-1  1.7430845               5               5\n#> AAACCGTGTATGCG-1  1.2244898               6               6\n#> AAACGCACTGGTAC-1  1.6643551               2               2\nGetAssayData(pbmc_processed)[1:15,1:5]\n#> 15 x 5 sparse Matrix of class \"dgCMatrix\"\n#>               AAACATACAACCAC-1 AAACATTGAGCTAC-1\n#> AL627309.1                   .         .       \n#> AP006222.2                   .         .       \n#> RP11-206L10.2                .         .       \n#> RP11-206L10.9                .         .       \n#> LINC00115                    .         .       \n#> NOC2L                        .         .       \n#> KLHL17                       .         .       \n#> PLEKHN1                      .         .       \n#> RP11-54O7.17                 .         .       \n#> HES4                         .         .       \n#> RP11-54O7.11                 .         .       \n#> ISG15                        .         .       \n#> AGRN                         .         .       \n#> C1orf159                     .         .       \n#> TNFRSF18                     .         1.625141\n#>               AAACATTGATCAGC-1 AAACCGTGCTTCCG-1\n#> AL627309.1            .                 .      \n#> AP006222.2            .                 .      \n#> RP11-206L10.2         .                 .      \n#> RP11-206L10.9         .                 .      \n#> LINC00115             .                 .      \n#> NOC2L                 .                 .      \n#> KLHL17                .                 .      \n#> PLEKHN1               .                 .      \n#> RP11-54O7.17          .                 .      \n#> HES4                  .                 .      \n#> RP11-54O7.11          .                 .      \n#> ISG15                 1.429744          3.55831\n#> AGRN                  .                 .      \n#> C1orf159              .                 .      \n#> TNFRSF18              .                 .      \n#>               AAACCGTGTATGCG-1\n#> AL627309.1                   .\n#> AP006222.2                   .\n#> RP11-206L10.2                .\n#> RP11-206L10.9                .\n#> LINC00115                    .\n#> NOC2L                        .\n#> KLHL17                       .\n#> PLEKHN1                      .\n#> RP11-54O7.17                 .\n#> HES4                         .\n#> RP11-54O7.11                 .\n#> ISG15                        .\n#> AGRN                         .\n#> C1orf159                     .\n#> TNFRSF18                     .\nGetAssayData(pbmc_processed, slot='counts')[1:15,1:5]\n#> 15 x 5 sparse Matrix of class \"dgCMatrix\"\n#>               AAACATACAACCAC-1 AAACATTGAGCTAC-1\n#> AL627309.1                   .                .\n#> AP006222.2                   .                .\n#> RP11-206L10.2                .                .\n#> RP11-206L10.9                .                .\n#> LINC00115                    .                .\n#> NOC2L                        .                .\n#> KLHL17                       .                .\n#> PLEKHN1                      .                .\n#> RP11-54O7.17                 .                .\n#> HES4                         .                .\n#> RP11-54O7.11                 .                .\n#> ISG15                        .                .\n#> AGRN                         .                .\n#> C1orf159                     .                .\n#> TNFRSF18                     .                2\n#>               AAACATTGATCAGC-1 AAACCGTGCTTCCG-1\n#> AL627309.1                   .                .\n#> AP006222.2                   .                .\n#> RP11-206L10.2                .                .\n#> RP11-206L10.9                .                .\n#> LINC00115                    .                .\n#> NOC2L                        .                .\n#> KLHL17                       .                .\n#> PLEKHN1                      .                .\n#> RP11-54O7.17                 .                .\n#> HES4                         .                .\n#> RP11-54O7.11                 .                .\n#> ISG15                        1                9\n#> AGRN                         .                .\n#> C1orf159                     .                .\n#> TNFRSF18                     .                .\n#>               AAACCGTGTATGCG-1\n#> AL627309.1                   .\n#> AP006222.2                   .\n#> RP11-206L10.2                .\n#> RP11-206L10.9                .\n#> LINC00115                    .\n#> NOC2L                        .\n#> KLHL17                       .\n#> PLEKHN1                      .\n#> RP11-54O7.17                 .\n#> HES4                         .\n#> RP11-54O7.11                 .\n#> ISG15                        .\n#> AGRN                         .\n#> C1orf159                     .\n#> TNFRSF18                     ."},{"path":"seuratobject.html","id":"plotting","chapter":"5 The Seurat object","heading":"5.3 Plotting","text":"Lets plot classic UMAP DimPlot- defaults clusters ‘umap’ view.checking gene expression? Genes called ‘features’ Seurat object (CITE-seq ’d proteins!). FeaturePlot() function show gene expression.also works continuous cell-level data - column metadata table.showing CD14 expression across clusters (categorical information metadata)","code":"\nDimPlot(pbmc_processed)\n# equivalent to\n#DimPlot(pbmc_processed, reduction = 'umap')\nFeaturePlot(pbmc_processed, features =  \"CD14\")\nFeaturePlot(pbmc_processed, features =  \"percent.mt\")\nVlnPlot(pbmc_processed, features = 'CD14')"},{"path":"seuratobject.html","id":"discussion-the-seurat-object-in-r","chapter":"5 The Seurat object","heading":"Discussion: The Seurat Object in R","text":"Lets take look seurat object just created R, pbmc_processedTo accomodate complexity data arising single cell RNA seq experiment, seurat object keeps container multiple data tables linked.functions seurat can access parts data object analysis visualisation, cover later .essentially data containers R class, can accessed variable R environment.Classes pre-defined can contain multiple data tables metadata. Seurat, three types.Seurat - main data class, contains data.Assay - found within Seurat object. Depending experiment cell data RNA, ATAC etc measuredDimReduc - PCA UMAPSlots parts within class contain specific data. can lists, data tables vectors can accessed conventional R methods.Many functions Seurat operate data class slots within seamlessly. maybe occasion access separately hack , however advanced analysis method.Examples accessing Seurat objectThe assays slot pbmc_processed can accessed pbmc_processed@assays.RNA assay can accessed pbmc_processed@assays$RNA.often want access assays, Seurat nicely gives us shortcut pbmc_processed$RNA. may sometimes see alternative notation pbmc_processed[[\"RNA\"]].general, slots always object accessed @ things may different different data sets accessed $.goUse str look structure Seurat object pbmc_processed.meta.data slot within Seurat object currently? type data contained ?count data within Seurat object?","code":""},{"path":"load.html","id":"load","chapter":"6 Load data","heading":"6 Load data","text":"workshop follows introductory Guided Clustering Tutorial tutorial Seurat.bulk workshop may found original format .","code":""},{"path":"load.html","id":"setup-the-seurat-object","chapter":"6 Load data","heading":"6.1 Setup the Seurat Object","text":"tutorial, analyzing dataset Peripheral Blood Mononuclear Cells (PBMC) freely available 10X Genomics. 2,700 single cells sequenced Illumina NextSeq 500. raw data can found .start reading data. Read10X() function reads output cellranger pipeline 10X, returning unique molecular identified (UMI) count matrix. values matrix represent number molecules feature (.e. gene; row) detected cell (column).next use count matrix create Seurat object. object serves container contains data (like count matrix) analysis (like PCA, clustering results) single-cell dataset. technical discussion Seurat object structure, check GitHub Wiki. example, count matrix stored pbmc@assays$RNA@counts.. values matrix represent 0s (molecules detected). Since values scRNA-seq matrix 0, Seurat uses sparse-matrix representation whenever possible. results significant memory speed savings Drop-seq/inDrop/10x data.","code":"\nlibrary(dplyr)\nlibrary(ggplot2)\nlibrary(Seurat)\nlibrary(patchwork)\n# Load the PBMC dataset\npbmc.data <- Read10X(data.dir = \"data/pbmc3k/filtered_gene_bc_matrices/hg19/\")\n# Initialize the Seurat object with the raw (non-normalized data).\npbmc <- CreateSeuratObject(counts = pbmc.data, project = \"pbmc3k\", min.cells = 3, min.features = 200)\npbmc\n#> An object of class Seurat \n#> 13714 features across 2700 samples within 1 assay \n#> Active assay: RNA (13714 features, 0 variable features)\n# Lets examine a few genes in the first thirty cells\npbmc.data[c(\"CD3D\",\"TCL1A\",\"MS4A1\"), 1:30]\n#> 3 x 30 sparse Matrix of class \"dgCMatrix\"\n#>    [[ suppressing 30 column names 'AAACATACAACCAC-1', 'AAACATTGAGCTAC-1', 'AAACATTGATCAGC-1' ... ]]\n#>                                                            \n#> CD3D  4 . 10 . . 1 2 3 1 . . 2 7 1 . . 1 3 . 2  3 . . . . .\n#> TCL1A . .  . . . . . . 1 . . . . . . . . . . .  . 1 . . . .\n#> MS4A1 . 6  . . . . . . 1 1 1 . . . . . . . . . 36 1 2 . . 2\n#>              \n#> CD3D  3 4 1 5\n#> TCL1A . . . .\n#> MS4A1 . . . .\ndense.size <- object.size(as.matrix(pbmc.data))\ndense.size\n#> 709591472 bytes\nsparse.size <- object.size(pbmc.data)\nsparse.size\n#> 29905192 bytes\ndense.size / sparse.size\n#> 23.7 bytes"},{"path":"qc.html","id":"qc","chapter":"7 QC Filtering","heading":"7 QC Filtering","text":"steps encompass standard pre-processing workflow scRNA-seq data Seurat. represent selection filtration cells based QC metrics, data normalization scaling, detection highly variable features.","code":""},{"path":"qc.html","id":"qc-and-selecting-cells-for-further-analysis","chapter":"7 QC Filtering","heading":"7.1 QC and selecting cells for further analysis","text":"Seurat allows easily explore QC metrics filter cells based user-defined criteria. QC metrics commonly used community includeThe number unique genes detected cell.\nLow-quality cells empty droplets often genes\nCell doublets multiplets may exhibit aberrantly high gene count\nLow-quality cells empty droplets often genesCell doublets multiplets may exhibit aberrantly high gene countSimilarly, total number molecules detected within cell (correlates strongly unique genes)percentage reads map mitochondrial genome\nLow-quality / dying cells often exhibit extensive mitochondrial contamination\ncalculate mitochondrial QC metrics PercentageFeatureSet() function, calculates percentage counts originating set features\nuse set genes starting MT- set mitochondrial genes\nLow-quality / dying cells often exhibit extensive mitochondrial contaminationWe calculate mitochondrial QC metrics PercentageFeatureSet() function, calculates percentage counts originating set featuresWe use set genes starting MT- set mitochondrial genes","code":"\n# The $ operator can add columns to object metadata. \n# This is a great place to stash QC stats\npbmc$percent.mt <- PercentageFeatureSet(pbmc, pattern = \"^MT-\")"},{"path":"qc.html","id":"challenge-the-meta.data-slot-in-the-seurat-object","chapter":"7 QC Filtering","heading":"Challenge: The meta.data slot in the Seurat object","text":"QC metrics stored Seurat?number unique genes total molecules automatically calculated CreateSeuratObject()\ncan find stored object meta data\ncan find stored object meta dataWhat notice changed within meta.data table now calculated mitochondrial gene proportion?add data meta.data table?","code":""},{"path":"qc.html","id":"section","chapter":"7 QC Filtering","heading":"","text":"example , visualize QC metrics, use filter cells.filter cells unique feature counts 2,500 less 200We filter cells >5% mitochondrial countsLets look number features (genes) percent mitochondrial genes plot.","code":"\n#Visualize QC metrics as a violin plot\nVlnPlot(pbmc, features = c(\"nFeature_RNA\", \"nCount_RNA\", \"percent.mt\"), ncol = 3)\n# FeatureScatter is typically used to visualize feature-feature relationships, \n# but can be used for anything calculated by the object, \n# i.e. columns in object metadata, PC scores etc.\nplot1 <- FeatureScatter(pbmc, feature1 = \"nCount_RNA\", feature2 = \"percent.mt\") \nplot2 <- FeatureScatter(pbmc, feature1 = \"nCount_RNA\", feature2 = \"nFeature_RNA\") \nplot1 + plot2\nplot3 <- FeatureScatter(pbmc, feature1 = \"nFeature_RNA\", feature2 = \"percent.mt\") \nplot3"},{"path":"qc.html","id":"challenge-ribosomal-gene-expression-as-a-qc-metric","chapter":"7 QC Filtering","heading":"Challenge: Ribosomal gene expression as a QC metric","text":"Ribosomal gene expression another factor look cells within experiment.Create columns metadata using PercentageFeatureSet function, time search ribosomal genes. can calculate percentage large subunit (RPL) small subunit (RPS) ribosomal genes.Use FeatureScatter plot combinations metrics available metadata. mitochondrial gene percentage related ribosomal gene percentage? can see? Discuss break .Create new meta.data columns contain percentages large small ribosomal genes.plot scatter plot new data. find large small ribosomal subunit genes correlated within cell.mitochondria gene, feature counts?","code":""},{"path":"qc.html","id":"section-1","chapter":"7 QC Filtering","heading":"","text":"Okay happy thresholds mitochondrial percentage cells, lets apply subset data. remove cells think poor quality.Lets replot feature scatters see look like.","code":"\npbmc <- subset(pbmc, subset = nFeature_RNA > 200 & nFeature_RNA < 2500 & percent.mt < 5)\nplot5 <- FeatureScatter(pbmc, feature1 = \"nCount_RNA\", feature2 = \"percent.mt\") \nplot6 <- FeatureScatter(pbmc, feature1 = \"nCount_RNA\", feature2 = \"nFeature_RNA\") \nplot5 + plot6"},{"path":"norm.html","id":"norm","chapter":"8 Normalisation","heading":"8 Normalisation","text":"removing unwanted cells dataset, next step normalize data. default, employ global-scaling normalization method “LogNormalize” normalizes feature expression measurements cell total expression, multiplies scale factor (10,000 default), log-transforms result. Normalized values stored pbmc$RNA@data.clarity, previous line code (future commands), provide default values certain parameters function call. However, isn’t required behavior can achieved :","code":"\npbmc <- NormalizeData(pbmc, normalization.method = \"LogNormalize\", scale.factor = 1e4)\npbmc <- NormalizeData(pbmc)"},{"path":"reducedims.html","id":"reducedims","chapter":"9 PCAs and UMAPs","heading":"9 PCAs and UMAPs","text":"","code":""},{"path":"reducedims.html","id":"identification-of-highly-variable-features-feature-selection","chapter":"9 PCAs and UMAPs","heading":"9.1 Identification of highly variable features (feature selection)","text":"next calculate subset features exhibit high cell--cell variation dataset (.e, highly expressed cells, lowly expressed others). others found focusing genes downstream analysis helps highlight biological signal single-cell datasets.procedure Seurat described detail , improves previous versions directly modeling mean-variance relationship inherent single-cell data, implemented FindVariableFeatures() function. default, return 2,000 features per dataset. used downstream analysis, like PCA.","code":"\npbmc <- FindVariableFeatures(pbmc, selection.method = 'vst', nfeatures = 2000)\n# Identify the 10 most highly variable genes\ntop10 <- head(VariableFeatures(pbmc), 10)\n# plot variable features with and without labels\nplot1 <- VariableFeaturePlot(pbmc)\nplot2 <- LabelPoints(plot = plot1, points = top10, repel = TRUE)\n#> When using repel, set xnudge and ynudge to 0 for optimal results\nplot1 + plot2\n#> Warning: Transformation introduced infinite values in\n#> continuous x-axis\n#> Warning: Removed 1 rows containing missing values\n#> (geom_point).\n#> Warning: Transformation introduced infinite values in\n#> continuous x-axis\n#> Warning: Removed 1 rows containing missing values\n#> (geom_point)."},{"path":"reducedims.html","id":"challenge-labelling-genes-of-interest","chapter":"9 PCAs and UMAPs","heading":"Challenge: Labelling Genes of Interest","text":"wanted look genes specifically interested ? can create character vector gene names apply plot.Make plot labels genes IL8, IDH2 CXCL3.","code":""},{"path":"reducedims.html","id":"scaling-the-data","chapter":"9 PCAs and UMAPs","heading":"9.2 Scaling the data","text":"Next, apply linear transformation (‘scaling’) standard pre-processing step prior dimensional reduction techniques like PCA. ScaleData() function:Shifts expression gene, mean expression across cells 0Scales expression gene, variance across cells 1\nstep gives equal weight downstream analyses, highly-expressed genes dominate\nstep gives equal weight downstream analyses, highly-expressed genes dominateThe results stored pbmc$RNA@scale.dataScaling essential step Seurat workflow, genes used input PCA. Therefore, default ScaleData() perform scaling previously identified variable features (2,000 default). , omit features argument previous function call, .e.Seurat v2 also use ScaleData() function remove unwanted sources variation single-cell dataset. example, ‘regress ’ heterogeneity associated (example) cell cycle stage, mitochondrial contamination. features still supported ScaleData() Seurat v3, .e.: ","code":"\nall.genes <- rownames(pbmc)\npbmc <- ScaleData(pbmc, features = all.genes)\n#> Centering and scaling data matrix\n# pbmc <- ScaleData(pbmc)\n# pbmc <- ScaleData(pbmc, vars.to.regress = 'percent.mt')"},{"path":"reducedims.html","id":"perform-linear-dimensional-reduction","chapter":"9 PCAs and UMAPs","heading":"9.3 Perform linear dimensional reduction","text":"Next perform PCA scaled data. default, previously determined variable features used input, can defined using features argument wish choose different subset.Seurat provides several useful ways visualizing cells features define PCA, including VizDimReduction(), DimPlot(), DimHeatmap()particular DimHeatmap() allows easy exploration primary sources heterogeneity dataset, can useful trying decide PCs include downstream analyses. cells features ordered according PCA scores. Setting cells number plots ‘extreme’ cells ends spectrum, dramatically speeds plotting large datasets. Though clearly supervised analysis, find valuable tool exploring correlated feature sets.","code":"\npbmc <- RunPCA(pbmc, features = VariableFeatures(object = pbmc))\n#> PC_ 1 \n#> Positive:  CST3, TYROBP, LST1, AIF1, FTL, FTH1, LYZ, FCN1, S100A9, TYMP \n#>     FCER1G, CFD, LGALS1, S100A8, CTSS, LGALS2, SERPINA1, IFITM3, SPI1, CFP \n#>     PSAP, IFI30, SAT1, COTL1, S100A11, NPC2, GRN, LGALS3, GSTP1, PYCARD \n#> Negative:  MALAT1, LTB, IL32, IL7R, CD2, B2M, ACAP1, CD27, STK17A, CTSW \n#>     CD247, GIMAP5, AQP3, CCL5, SELL, TRAF3IP3, GZMA, MAL, CST7, ITM2A \n#>     MYC, GIMAP7, HOPX, BEX2, LDLRAP1, GZMK, ETS1, ZAP70, TNFAIP8, RIC3 \n#> PC_ 2 \n#> Positive:  CD79A, MS4A1, TCL1A, HLA-DQA1, HLA-DQB1, HLA-DRA, LINC00926, CD79B, HLA-DRB1, CD74 \n#>     HLA-DMA, HLA-DPB1, HLA-DQA2, CD37, HLA-DRB5, HLA-DMB, HLA-DPA1, FCRLA, HVCN1, LTB \n#>     BLNK, P2RX5, IGLL5, IRF8, SWAP70, ARHGAP24, FCGR2B, SMIM14, PPP1R14A, C16orf74 \n#> Negative:  NKG7, PRF1, CST7, GZMB, GZMA, FGFBP2, CTSW, GNLY, B2M, SPON2 \n#>     CCL4, GZMH, FCGR3A, CCL5, CD247, XCL2, CLIC3, AKR1C3, SRGN, HOPX \n#>     TTC38, APMAP, CTSC, S100A4, IGFBP7, ANXA1, ID2, IL32, XCL1, RHOC \n#> PC_ 3 \n#> Positive:  HLA-DQA1, CD79A, CD79B, HLA-DQB1, HLA-DPB1, HLA-DPA1, CD74, MS4A1, HLA-DRB1, HLA-DRA \n#>     HLA-DRB5, HLA-DQA2, TCL1A, LINC00926, HLA-DMB, HLA-DMA, CD37, HVCN1, FCRLA, IRF8 \n#>     PLAC8, BLNK, MALAT1, SMIM14, PLD4, LAT2, IGLL5, P2RX5, SWAP70, FCGR2B \n#> Negative:  PPBP, PF4, SDPR, SPARC, GNG11, NRGN, GP9, RGS18, TUBB1, CLU \n#>     HIST1H2AC, AP001189.4, ITGA2B, CD9, TMEM40, PTCRA, CA2, ACRBP, MMD, TREML1 \n#>     NGFRAP1, F13A1, SEPT5, RUFY1, TSC22D1, MPP1, CMTM5, RP11-367G6.3, MYL9, GP1BA \n#> PC_ 4 \n#> Positive:  HLA-DQA1, CD79B, CD79A, MS4A1, HLA-DQB1, CD74, HLA-DPB1, HIST1H2AC, PF4, TCL1A \n#>     SDPR, HLA-DPA1, HLA-DRB1, HLA-DQA2, HLA-DRA, PPBP, LINC00926, GNG11, HLA-DRB5, SPARC \n#>     GP9, AP001189.4, CA2, PTCRA, CD9, NRGN, RGS18, GZMB, CLU, TUBB1 \n#> Negative:  VIM, IL7R, S100A6, IL32, S100A8, S100A4, GIMAP7, S100A10, S100A9, MAL \n#>     AQP3, CD2, CD14, FYB, LGALS2, GIMAP4, ANXA1, CD27, FCN1, RBP7 \n#>     LYZ, S100A11, GIMAP5, MS4A6A, S100A12, FOLR3, TRABD2A, AIF1, IL8, IFI6 \n#> PC_ 5 \n#> Positive:  GZMB, NKG7, S100A8, FGFBP2, GNLY, CCL4, CST7, PRF1, GZMA, SPON2 \n#>     GZMH, S100A9, LGALS2, CCL3, CTSW, XCL2, CD14, CLIC3, S100A12, CCL5 \n#>     RBP7, MS4A6A, GSTP1, FOLR3, IGFBP7, TYROBP, TTC38, AKR1C3, XCL1, HOPX \n#> Negative:  LTB, IL7R, CKB, VIM, MS4A7, AQP3, CYTIP, RP11-290F20.3, SIGLEC10, HMOX1 \n#>     PTGES3, LILRB2, MAL, CD27, HN1, CD2, GDI2, ANXA5, CORO1B, TUBA1B \n#>     FAM110A, ATP1A1, TRADD, PPA1, CCDC109B, ABRACL, CTD-2006K23.1, WARS, VMO1, FYB\n# Examine and visualize PCA results a few different ways\nprint(pbmc$pca, dims = 1:5, nfeatures = 5)\n#> PC_ 1 \n#> Positive:  CST3, TYROBP, LST1, AIF1, FTL \n#> Negative:  MALAT1, LTB, IL32, IL7R, CD2 \n#> PC_ 2 \n#> Positive:  CD79A, MS4A1, TCL1A, HLA-DQA1, HLA-DQB1 \n#> Negative:  NKG7, PRF1, CST7, GZMB, GZMA \n#> PC_ 3 \n#> Positive:  HLA-DQA1, CD79A, CD79B, HLA-DQB1, HLA-DPB1 \n#> Negative:  PPBP, PF4, SDPR, SPARC, GNG11 \n#> PC_ 4 \n#> Positive:  HLA-DQA1, CD79B, CD79A, MS4A1, HLA-DQB1 \n#> Negative:  VIM, IL7R, S100A6, IL32, S100A8 \n#> PC_ 5 \n#> Positive:  GZMB, NKG7, S100A8, FGFBP2, GNLY \n#> Negative:  LTB, IL7R, CKB, VIM, MS4A7\nVizDimLoadings(pbmc, dims = 1:2, reduction = 'pca')\nDimPlot(pbmc, reduction = 'pca')\nDimHeatmap(pbmc, dims = 1, cells = 500, balanced = TRUE)\nDimHeatmap(pbmc, dims = 1:15, cells = 500, balanced = TRUE)"},{"path":"reducedims.html","id":"determine-the-dimensionality-of-the-dataset","chapter":"9 PCAs and UMAPs","heading":"9.4 Determine the ‘dimensionality’ of the dataset","text":"overcome extensive technical noise single feature scRNA-seq data, Seurat clusters cells based PCA scores, PC essentially representing ‘metafeature’ combines information across correlated feature set. top principal components therefore represent robust compression dataset. However, many components choose include? 10? 20? 100?alternative heuristic method generates ‘Elbow plot’: ranking principle components based percentage variance explained one (ElbowPlot() function). example, can observe ‘elbow’ around PC9-10, suggesting majority true signal captured first 10 PCs.Identifying true dimensionality dataset – can challenging/uncertain user. therefore suggest three approaches consider. first supervised, exploring PCs determine relevant sources heterogeneity, used conjunction GSEA example. second implements statistical test based random null model, time-consuming large datasets, may return clear PC cutoff. third heuristic commonly used, can calculated instantly. example, three approaches yielded similar results, might justified choosing anything PC 7-12 cutoff.chose 10 , encourage users consider following:Dendritic cell NK aficionados may recognize genes strongly associated PCs 12 13 define rare immune subsets (.e. MZB1 marker plasmacytoid DCs). However, groups rare, difficult distinguish background noise dataset size without prior knowledge.encourage users repeat downstream analyses different number PCs (10, 15, even 50!). observe, results often differ dramatically.advise users err higher side choosing parameter. example, performing downstream analyses 5 PCs significantly adversely affect results.","code":"\nElbowPlot(pbmc)"},{"path":"reducedims.html","id":"run-non-linear-dimensional-reduction-umaptsne","chapter":"9 PCAs and UMAPs","heading":"9.5 Run non-linear dimensional reduction (UMAP/tSNE)","text":"Seurat offers several non-linear dimensional reduction techniques, tSNE UMAP, visualize explore datasets. goal algorithms learn underlying manifold data order place similar cells together low-dimensional space. Cells within graph-based clusters determined co-localize dimension reduction plots. input UMAP tSNE, suggest using PCs input clustering analysis.can save object point can easily loaded back without rerun computationally intensive steps performed , easily shared collaborators.","code":"\n# If you haven't installed UMAP, you can do so via reticulate::py_install(packages = \"umap-learn\")\npbmc <- RunUMAP(pbmc, dims = 1:10)\n#> Warning: The default method for RunUMAP has changed from calling Python UMAP via reticulate to the R-native UWOT using the cosine metric\n#> To use Python UMAP via reticulate, set umap.method to 'umap-learn' and metric to 'correlation'\n#> This message will be shown once per session\n#> 13:28:13 UMAP embedding parameters a = 0.9922 b = 1.112\n#> 13:28:13 Read 2638 rows and found 10 numeric columns\n#> 13:28:13 Using Annoy for neighbor search, n_neighbors = 30\n#> 13:28:13 Building Annoy index with metric = cosine, n_trees = 50\n#> 0%   10   20   30   40   50   60   70   80   90   100%\n#> [----|----|----|----|----|----|----|----|----|----|\n#> **************************************************|\n#> 13:28:13 Writing NN index file to temp file /var/folders/tp/b078yqdd4ydff9fx87lfttpj_sc0x3/T//RtmpZy8Ddq/fileacbb43a90b8a\n#> 13:28:13 Searching Annoy index using 1 thread, search_k = 3000\n#> 13:28:13 Annoy recall = 100%\n#> 13:28:14 Commencing smooth kNN distance calibration using 1 thread\n#> 13:28:14 Initializing from normalized Laplacian + noise\n#> 13:28:14 Commencing optimization for 500 epochs, with 105124 positive edges\n#> 13:28:18 Optimization finished\n# note that you can set `label = TRUE` or use the LabelClusters function to help label individual clusters\nDimPlot(pbmc, reduction = 'umap')\nsaveRDS(pbmc, file = \"pbmc_tutorial.rds\")"},{"path":"clustering.html","id":"clustering","chapter":"10 Clustering","heading":"10 Clustering","text":"Seurat v3 applies graph-based clustering approach, building upon initial strategies (Macosko et al). Importantly, distance metric drives clustering analysis (based previously identified PCs) remains . However, approach partitioning cellular distance matrix clusters dramatically improved. approach heavily inspired recent manuscripts applied graph-based clustering approaches scRNA-seq data [SNN-Cliq, Xu Su, Bioinformatics, 2015] CyTOF data [PhenoGraph, Levine et al., Cell, 2015]. Briefly, methods embed cells graph structure - example K-nearest neighbor (KNN) graph, edges drawn cells similar feature expression patterns, attempt partition graph highly interconnected ‘quasi-cliques’ ‘communities’.PhenoGraph, first construct KNN graph based euclidean distance PCA space, refine edge weights two cells based shared overlap local neighborhoods (Jaccard similarity). step performed using FindNeighbors() function, takes input previously defined dimensionality dataset (first 10 PCs).cluster cells, next apply modularity optimization techniques Louvain algorithm (default) SLM [SLM, Blondel et al., Journal Statistical Mechanics], iteratively group cells together, goal optimizing standard modularity function. FindClusters() function implements procedure, contains resolution parameter sets ‘granularity’ downstream clustering, increased values leading greater number clusters. find setting parameter 0.4-1.2 typically returns good results single-cell datasets around 3K cells. Optimal resolution often increases larger datasets. clusters can found using Idents() function.","code":"\npbmc <- FindNeighbors(pbmc, dims = 1:10)\n#> Computing nearest neighbor graph\n#> Computing SNN\npbmc <- FindClusters(pbmc, resolution = 0.5)\n#> Modularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck\n#> \n#> Number of nodes: 2638\n#> Number of edges: 95965\n#> \n#> Running Louvain algorithm...\n#> Maximum modularity in 10 random starts: 0.8723\n#> Number of communities: 9\n#> Elapsed time: 0 seconds\n# Look at cluster IDs of the first 5 cells\nhead(Idents(pbmc), 5)\n#> AAACATACAACCAC-1 AAACATTGAGCTAC-1 AAACATTGATCAGC-1 \n#>                2                3                2 \n#> AAACCGTGCTTCCG-1 AAACCGTGTATGCG-1 \n#>                1                6 \n#> Levels: 0 1 2 3 4 5 6 7 8"},{"path":"clustering.html","id":"challenge-try-different-cluster-settings","chapter":"10 Clustering","heading":"Challenge: Try different cluster settings","text":"Run FindNeighbours FindClusters , different number dimensions different resolution. Examine resulting clusters using DimPlot.maintain flow tutorial, please put output exploration different variable, pbmc2!","code":""},{"path":"cluster-markers.html","id":"cluster-markers","chapter":"11 Cluster Markers","heading":"11 Cluster Markers","text":"","code":""},{"path":"cluster-markers.html","id":"finding-differentially-expressed-features-cluster-biomarkers","chapter":"11 Cluster Markers","heading":"11.1 Finding differentially expressed features (cluster biomarkers)","text":"Seurat can help find markers define clusters via differential expression. default, identifies positive negative markers single cluster (specified ident.1), compared cells. FindAllMarkers() automates process clusters, can also test groups clusters vs. , cells.min.pct argument requires feature detected minimum percentage either two groups cells, thresh.test argument requires feature differentially expressed (average) amount two groups. can set 0, dramatic increase time - since test large number features unlikely highly discriminatory. another option speed computations, max.cells.per.ident can set. downsample identity class cells whatever set . generally going loss power, speed increases can significant highly differentially expressed features likely still rise top.Seurat several tests differential expression can set test.use parameter (see DE vignette details). example, ROC test returns ‘classification power’ abs(AUC-0.5)*2 individual marker, ranging 0 = random 1 = perfect.include several tools visualizing marker expression. VlnPlot() (shows expression probability distributions across clusters), FeaturePlot() (visualizes feature expression tSNE PCA plot) commonly used visualizations. also suggest exploring RidgePlot(), CellScatter(), DotPlot() additional methods view dataset.ridgeplots, cell scatter plots dotplots. Replace FeaturePlot functions.\nCellScatter plots, need cell id cells want look . can get cell metadata (pbmc@meta.data).DotPlotsWhich plots prefer? Discuss.DoHeatmap() generates expression heatmap given cells features. case, plotting top 20 markers (markers less 20) cluster.","code":"\n# find all markers of cluster 2\ncluster2.markers <- FindMarkers(pbmc, ident.1 = 2, min.pct = 0.25)\nhead(cluster2.markers, n = 5)\n#>             p_val avg_log2FC pct.1 pct.2    p_val_adj\n#> IL32 2.593535e-91  1.2154360 0.949 0.466 3.556774e-87\n#> LTB  7.994465e-87  1.2828597 0.981 0.644 1.096361e-82\n#> CD3D 3.922451e-70  0.9359210 0.922 0.433 5.379250e-66\n#> IL7R 1.130870e-66  1.1776027 0.748 0.327 1.550876e-62\n#> LDHB 4.082189e-65  0.8837324 0.953 0.614 5.598314e-61\n# find all markers distinguishing cluster 5 from clusters 0 and 3\ncluster5.markers <- FindMarkers(pbmc, ident.1 = 5, ident.2 = c(0, 3), min.pct = 0.25)\nhead(cluster5.markers, n = 5)\n#>                       p_val avg_log2FC pct.1 pct.2\n#> FCGR3A        2.150929e-209   4.267579 0.975 0.039\n#> IFITM3        6.103366e-199   3.877105 0.975 0.048\n#> CFD           8.891428e-198   3.411039 0.938 0.037\n#> CD68          2.374425e-194   3.014535 0.926 0.035\n#> RP11-290F20.3 9.308287e-191   2.722684 0.840 0.016\n#>                   p_val_adj\n#> FCGR3A        2.949784e-205\n#> IFITM3        8.370156e-195\n#> CFD           1.219370e-193\n#> CD68          3.256286e-190\n#> RP11-290F20.3 1.276538e-186\n# find markers for every cluster compared to all remaining cells, report only the positive ones\npbmc.markers <- FindAllMarkers(pbmc, only.pos = TRUE, min.pct = 0.25, logfc.threshold = 0.25)\n#> Calculating cluster 0\n#> Calculating cluster 1\n#> Calculating cluster 2\n#> Calculating cluster 3\n#> Calculating cluster 4\n#> Calculating cluster 5\n#> Calculating cluster 6\n#> Calculating cluster 7\n#> Calculating cluster 8\npbmc.markers %>% group_by(cluster) %>% slice_max(n = 2, order_by = avg_log2FC)\n#> # A tibble: 18 × 7\n#> # Groups:   cluster [9]\n#>        p_val avg_log2FC pct.1 pct.2 p_val_adj cluster gene  \n#>        <dbl>      <dbl> <dbl> <dbl>     <dbl> <fct>   <chr> \n#>  1 1.17e- 83       1.33 0.435 0.108 1.60e- 79 0       CCR7  \n#>  2 1.74e-109       1.07 0.897 0.593 2.39e-105 0       LDHB  \n#>  3 0               5.57 0.996 0.215 0         1       S100A9\n#>  4 0               5.48 0.975 0.121 0         1       S100A8\n#>  5 7.99e- 87       1.28 0.981 0.644 1.10e- 82 2       LTB   \n#>  6 2.61e- 59       1.24 0.424 0.111 3.58e- 55 2       AQP3  \n#>  7 0               4.31 0.936 0.041 0         3       CD79A \n#>  8 9.48e-271       3.59 0.622 0.022 1.30e-266 3       TCL1A \n#>  9 4.93e-169       3.01 0.595 0.056 6.76e-165 4       GZMK  \n#> 10 1.17e-178       2.97 0.957 0.241 1.60e-174 4       CCL5  \n#> 11 3.51e-184       3.31 0.975 0.134 4.82e-180 5       FCGR3A\n#> 12 2.03e-125       3.09 1     0.315 2.78e-121 5       LST1  \n#> 13 6.82e-175       4.92 0.958 0.135 9.36e-171 6       GNLY  \n#> 14 1.05e-265       4.89 0.986 0.071 1.44e-261 6       GZMB  \n#> 15 1.48e-220       3.87 0.812 0.011 2.03e-216 7       FCER1A\n#> 16 1.67e- 21       2.87 1     0.513 2.28e- 17 7       HLA-D…\n#> 17 3.68e-110       8.58 1     0.024 5.05e-106 8       PPBP  \n#> 18 7.73e-200       7.24 1     0.01  1.06e-195 8       PF4\ncluster0.markers <- FindMarkers(pbmc, ident.1 = 0, logfc.threshold = 0.25, test.use = \"roc\", only.pos = TRUE)\nVlnPlot(pbmc, features = c(\"MS4A1\", \"CD79A\"))\n# you can plot raw counts as well\nVlnPlot(pbmc, features = c(\"NKG7\", \"PF4\"), slot = 'counts', log = TRUE)\nFeaturePlot(pbmc, features = c(\"MS4A1\", \"GNLY\", \"CD3E\", \"CD14\", \"FCER1A\", \"FCGR3A\", \"LYZ\", \"PPBP\", \"CD8A\"))\nRidgePlot(pbmc, features = c(\"MS4A1\", \"GNLY\", \"CD3E\", \"CD14\", \"FCER1A\", \"FCGR3A\", \"LYZ\", \"PPBP\", \"CD8A\"))\n#> Picking joint bandwidth of 0.0236\n#> Picking joint bandwidth of 0.0971\n#> Picking joint bandwidth of 0.125\n#> Picking joint bandwidth of 0.0337\n#> Picking joint bandwidth of 0.0659\n#> Picking joint bandwidth of 0.0872\n#> Picking joint bandwidth of 0.319\n#> Picking joint bandwidth of 0.033\n#> Picking joint bandwidth of 0.0368\nhead( pbmc@meta.data )\n#>                  orig.ident nCount_RNA nFeature_RNA\n#> AAACATACAACCAC-1     pbmc3k       2419          779\n#> AAACATTGAGCTAC-1     pbmc3k       4903         1352\n#> AAACATTGATCAGC-1     pbmc3k       3147         1129\n#> AAACCGTGCTTCCG-1     pbmc3k       2639          960\n#> AAACCGTGTATGCG-1     pbmc3k        980          521\n#> AAACGCACTGGTAC-1     pbmc3k       2163          781\n#>                  percent.mt RNA_snn_res.0.5 seurat_clusters\n#> AAACATACAACCAC-1  3.0177759               2               2\n#> AAACATTGAGCTAC-1  3.7935958               3               3\n#> AAACATTGATCAGC-1  0.8897363               2               2\n#> AAACCGTGCTTCCG-1  1.7430845               1               1\n#> AAACCGTGTATGCG-1  1.2244898               6               6\n#> AAACGCACTGGTAC-1  1.6643551               2               2\nCellScatter(pbmc, cell1 = \"AAACATACAACCAC-1\", cell2 = \"AAACATTGAGCTAC-1\")\nDotPlot(pbmc, features = c(\"MS4A1\", \"GNLY\", \"CD3E\", \"CD14\", \"FCER1A\", \"FCGR3A\", \"LYZ\", \"PPBP\", \"CD8A\"))\ntop10 <- pbmc.markers %>% group_by(cluster) %>% top_n(n = 10, wt = avg_log2FC)\nDoHeatmap(pbmc, features = top10$gene) + NoLegend()"},{"path":"cluster-markers.html","id":"assigning-cell-type-identity-to-clusters","chapter":"11 Cluster Markers","heading":"11.2 Assigning cell type identity to clusters","text":"Fortunately case dataset, can use canonical markers easily match unbiased clustering known cell types:","code":"\nnew.cluster.ids <- c(\"Naive CD4 T\", \"CD14+ Mono\", \"Memory CD4 T\", \"B\", \"CD8 T\", \"FCGR3A+ Mono\", \"NK\", \"DC\", \"Platelet\")\nnames(new.cluster.ids) <- levels(pbmc)\npbmc <- RenameIdents(pbmc, new.cluster.ids)\nDimPlot(pbmc, reduction = 'umap', label = TRUE, pt.size = 0.5) + NoLegend()\nsaveRDS(pbmc, file = \"pbmc3k_final.rds\")"},{"path":"singler.html","id":"singler","chapter":"12 SingleR","heading":"12 SingleR","text":"workshop focused Seurat package. However, another whole ecosystem R packages single cell analysis within Bioconductor. won’t go detail packages workshop, good material describing object type online : OSCA.now, ’ll just convert Seurat object object called SingleCellExperiment. popular packages Bioconductor work type Slingshot, Scran, Scater.now use package called SingleR label cell. SingleR uses reference data set cell types expression data infer best label cell. convenient collection cell type reference celldex package currently contains follow sets:example, ’ll use HumanPrimaryCellAtlasData set, contains high-level, fine-grained label types. Lets download reference datasetAn example types “fine” labels.Now ’ll label cells using SingleCellExperiment object, reference set.Keep types 10 cells label, put labels back Seurat object plot umap.nice see SingleR use clusters computed earlier, labels seem match clusters reasonably well.","code":"\n#install.packages(\"BiocManager\")\n#BiocManager::install(c(\"SingleCellExperiment\",\"SingleR\",\"celldex\"),ask=F)\nlibrary(SingleCellExperiment)\nlibrary(SingleR)\nlibrary(celldex)\nsce <- as.SingleCellExperiment(pbmc)\nls('package:celldex')\n#> [1] \"BlueprintEncodeData\"             \n#> [2] \"DatabaseImmuneCellExpressionData\"\n#> [3] \"HumanPrimaryCellAtlasData\"       \n#> [4] \"ImmGenData\"                      \n#> [5] \"MonacoImmuneData\"                \n#> [6] \"MouseRNAseqData\"                 \n#> [7] \"NovershternHematopoieticData\"\nref.set <- celldex::HumanPrimaryCellAtlasData()\n#> snapshotDate(): 2021-10-19\n#> see ?celldex and browseVignettes('celldex') for documentation\n#> loading from cache\n#> see ?celldex and browseVignettes('celldex') for documentation\n#> loading from cache\nhead(unique(ref.set$label.main))\n#> [1] \"DC\"                  \"Smooth_muscle_cells\"\n#> [3] \"Epithelial_cells\"    \"B_cell\"             \n#> [5] \"Neutrophils\"         \"T_cells\"\nhead(unique(ref.set$label.fine))\n#> [1] \"DC:monocyte-derived:immature\"       \n#> [2] \"DC:monocyte-derived:Galectin-1\"     \n#> [3] \"DC:monocyte-derived:LPS\"            \n#> [4] \"DC:monocyte-derived\"                \n#> [5] \"Smooth_muscle_cells:bronchial:vit_D\"\n#> [6] \"Smooth_muscle_cells:bronchial\"\npred.cnts <- SingleR::SingleR(test = sce, ref = ref.set, labels = ref.set$label.main)\nlbls.keep <- table(pred.cnts$first.labels)>10\npbmc$SingleR.labels <- ifelse(lbls.keep[pred.cnts$first.labels], pred.cnts$first.labels, 'Other')\nDimPlot(pbmc, reduction='umap', group.by='SingleR.labels')"},{"path":"de.html","id":"de","chapter":"13 Differential Expression","heading":"13 Differential Expression","text":"many different methods calculating differential expression groups scRNAseq data. number review papers worth consulting topic.Seurat differential expression Vignette walks variety implemented Seurat.example quickly looks 3 different methods test dataset. means complete guide!","code":"\nlibrary(Seurat)\nlibrary(tidyverse)\n#> ── Attaching packages ─────────────────── tidyverse 1.3.1 ──\n#> ✔ tibble  3.1.6     ✔ purrr   0.3.4\n#> ✔ tidyr   1.1.4     ✔ stringr 1.4.0\n#> ✔ readr   2.1.1     ✔ forcats 0.5.1\n#> ── Conflicts ────────────────────── tidyverse_conflicts() ──\n#> ✖ IRanges::collapse()      masks dplyr::collapse()\n#> ✖ Biobase::combine()       masks BiocGenerics::combine(), dplyr::combine()\n#> ✖ matrixStats::count()     masks dplyr::count()\n#> ✖ IRanges::desc()          masks dplyr::desc()\n#> ✖ tidyr::expand()          masks S4Vectors::expand()\n#> ✖ dplyr::filter()          masks stats::filter()\n#> ✖ S4Vectors::first()       masks dplyr::first()\n#> ✖ dplyr::lag()             masks stats::lag()\n#> ✖ BiocGenerics::Position() masks ggplot2::Position(), base::Position()\n#> ✖ purrr::reduce()          masks GenomicRanges::reduce(), IRanges::reduce()\n#> ✖ S4Vectors::rename()      masks dplyr::rename()\n#> ✖ IRanges::slice()         masks dplyr::slice()\nlibrary(patchwork)\n\ncondition_lookup <- \n  c('MantonBM1'=\"fake_treat\",   'MantonBM2'=\"fake_treat\",   'MantonBM3'=\"fake_treat\",   'MantonBM4'=\"fake_treat\",\n    'MantonBM5'=\"fake_control\", 'MantonBM6'=\"fake_control\", 'MantonBM7'=\"fake_control\", 'MantonBM8'=\"fake_control\")"},{"path":"de.html","id":"prepared-data","chapter":"13 Differential Expression","heading":"13.1 Prepared data","text":"need run - load pre prepared Seurat object.code downloads modifies hcabm40k dataset something small test differential expression .\ndataset data 8 individuals (pbmc3k one doner).Downloads hcabm40k dataset subsamples just 4000 cells.Assigns 8 individuals ‘fake_treat’ ‘fake_control’ groups. effectively differential expression .Take first 50 genes changes expression ‘fake treat’ group - multiply counts 4 add 1 subset. Now can expect genes ‘differentially expressed’","code":"\n################################################################################\n# Prepare a datasets\nlibrary(SeuratData)\ndata(\"hcabm40k\") \n\n# grab 4000 random cells\nkeep_cells <- sample(1:ncol(hcabm40k), size=4000)\n  \n# Subsample down to a toy sized dataset\nhcabm40k.mini <- hcabm40k[,keep_cells] \n# clear large object from memory\nrm(hcabm40k)\n\n# Add a group of contidion vs control to test. Not real\n# This is the first 4 of 8 bio replicates\nhcabm40k.mini$condition <- condition_lookup[hcabm40k.mini@meta.data$orig.ident]\n\n\n\n# ADDING SOME FAKE VARIATION!\n# Mmultipling first 40 genes of the the 'fake treat' group by 4 - so we expect these to be DE.\n# In reality, these are simply healthy replicates and shouldn't be significantly different\nalter_cells <- which(condition_lookup[hcabm40k.mini$orig.ident] == \"fake_treat\")\nalter_genes <- rownames(hcabm40k.mini@assays$RNA@counts)[1:50] \nhcabm40k.mini@assays$RNA@counts[alter_genes, alter_cells ] <- hcabm40k.mini@assays$RNA@counts[alter_genes, alter_cells  ]* 4\n# Plus - add 1 to some of them too (2*0 is 0)\nalter_cells2 <- sample(alter_cells, 500, replace = FALSE) # add 1 to x of 1979 cells.\nhcabm40k.mini@assays$RNA@counts[alter_genes, alter_cells2 ] <- hcabm40k.mini@assays$RNA@counts[alter_genes, alter_cells2  ]* +1\n\n\n# there's gene level meta data (meta.features) for each assay. \n# Recodring which values we changed.\nhcabm40k.mini[['RNA']][['is_altered']] <- rownames(hcabm40k.mini[['RNA']]) %in% alter_genes\n\n\n\n#-------------------------------------------------------------------------------\n#  Run thorough a basic processing, with no QC\n\nhcabm40k.mini <- NormalizeData(hcabm40k.mini, normalization.method = \"LogNormalize\", scale.factor = 10000)\nhcabm40k.mini <- FindVariableFeatures(hcabm40k.mini, selection.method = \"vst\", nfeatures = 2000)\nall.genes     <- rownames(hcabm40k.mini)\nhcabm40k.mini <- ScaleData(hcabm40k.mini, features = all.genes)\nhcabm40k.mini <- RunPCA(hcabm40k.mini, features = VariableFeatures(object = hcabm40k.mini))\nhcabm40k.mini <- RunUMAP(hcabm40k.mini, dims = 1:10)\nhcabm40k.mini <- FindNeighbors(hcabm40k.mini, dims = 1:10)\nhcabm40k.mini <- FindClusters(hcabm40k.mini, resolution = 0.1) # Low res\n\n\n#------------------------------------------------------------------------------\n# save\nsaveRDS(hcabm40k.mini, file=\"data/hcabm40k_mini_withfakevariation.rds\")"},{"path":"de.html","id":"load-data","chapter":"13 Differential Expression","heading":"13.2 Load Data","text":"Load small, edited subset data.first 50 genes altered higher ‘fake_treat’ group.","code":"\nhcabm40k.mini <- readRDS(file=\"data/hcabm40k_mini_withfakevariation.rds\")\ntable( hcabm40k.mini$orig.ident, hcabm40k.mini$condition)\n#>            \n#>             fake_control fake_treat\n#>   MantonBM1            0        502\n#>   MantonBM2            0        498\n#>   MantonBM3            0        481\n#>   MantonBM4            0        524\n#>   MantonBM5          467          0\n#>   MantonBM6          522          0\n#>   MantonBM7          476          0\n#>   MantonBM8          530          0\naltered_genes <- rownames(hcabm40k.mini[['RNA']])[1:50]\naltered_genes\n#>  [1] \"RP11-34P13.7\"  \"FO538757.2\"    \"AP006222.2\"   \n#>  [4] \"RP4-669L17.10\" \"RP5-857K21.4\"  \"RP11-206L10.9\"\n#>  [7] \"LINC00115\"     \"FAM41C\"        \"SAMD11\"       \n#> [10] \"NOC2L\"         \"KLHL17\"        \"PLEKHN1\"      \n#> [13] \"HES4\"          \"ISG15\"         \"AGRN\"         \n#> [16] \"C1orf159\"      \"TTLL10\"        \"TNFRSF18\"     \n#> [19] \"TNFRSF4\"       \"SDF4\"          \"B3GALT6\"      \n#> [22] \"FAM132A\"       \"RP5-902P8.12\"  \"UBE2J2\"       \n#> [25] \"RP5-902P8.10\"  \"SCNN1D\"        \"ACAP3\"        \n#> [28] \"PUSL1\"         \"CPSF3L\"        \"CPTP\"         \n#> [31] \"TAS1R3\"        \"DVL1\"          \"MXRA8\"        \n#> [34] \"AURKAIP1\"      \"CCNL2\"         \"MRPL20\"       \n#> [37] \"RP4-758J18.13\" \"ANKRD65\"       \"VWA1\"         \n#> [40] \"ATAD3C\"        \"ATAD3B\"        \"ATAD3A\"       \n#> [43] \"SSU72\"         \"RP5-832C2.5\"   \"C1orf233\"     \n#> [46] \"RP11-345P4.9\"  \"MIB2\"          \"MMP23B\"       \n#> [49] \"CDK11B\"        \"RP11-345P4.10\""},{"path":"de.html","id":"prefiltering","chapter":"13 Differential Expression","heading":"13.3 Prefiltering","text":"differential expression, generally ignore genes low exprssion.\nexpression certain level, almost impossible see differential expression.single cell datasets, many genes like . Aggressively filtering make dataset smaller runs quicker.","code":"\ntotal_per_gene <- rowSums(GetAssayData(hcabm40k.mini, 'counts'))\nhist(log10(total_per_gene))\nhcabm40k.mini <- hcabm40k.mini[total_per_gene >= 200, ] \n\np1 <- DimPlot(hcabm40k.mini, reduction = 'umap', group.by = 'seurat_clusters')\np2 <- DimPlot(hcabm40k.mini, reduction = 'umap', group.by = 'orig.ident')\np1+p2"},{"path":"de.html","id":"default-wilcox-test","chapter":"13 Differential Expression","heading":"13.4 Default Wilcox test","text":"","code":"\nhcabm40k.mini.c0 <- hcabm40k.mini[, hcabm40k.mini$seurat_clusters == 0]\n\n# Change Ident to condition\nIdents(hcabm40k.mini.c0) <- hcabm40k.mini.c0$condition\n\n# default, wilcox test\nde_result_wilcox <- FindMarkers(hcabm40k.mini.c0, \n            ident.1 = 'fake_treat',\n            ident.2 = 'fake_control',\n            logfc.threshold = 0, # Give me ALL results\n            min.pct = 0,\n            max.cells.per.ident = 400  # Downsample cells - purely for speed!\n            )\n\n# the  'DE' genes\nde_result_wilcox$was_altered <- rownames(de_result_wilcox ) %in% altered_genes\n\n# Add average expression for plotting\nde_result_wilcox$AveExpr<- rowMeans(hcabm40k.mini.c0[[\"RNA\"]][rownames(de_result_wilcox),])\n\n\n\n\ndplyr::filter(de_result_wilcox, p_val_adj < 0.01)\n#>                   p_val avg_log2FC pct.1 pct.2    p_val_adj\n#> RPS4Y1     1.112758e-35  1.3936383 0.642 0.166 6.420612e-32\n#> RPS9       1.333654e-18 -0.3109573 0.999 0.999 7.695182e-15\n#> HLA-B      7.425818e-17  0.4673660 0.993 0.975 4.284697e-13\n#> RPS4X      9.152161e-16 -0.2994496 1.000 0.999 5.280797e-12\n#> MT-CO1     3.334190e-10  0.1862243 0.999 0.997 1.923828e-06\n#> IFITM1     4.708315e-10  0.6330814 0.334 0.172 2.716698e-06\n#> CRIP1      6.560853e-10  0.7973784 0.334 0.141 3.785612e-06\n#> CTSW       1.514255e-09 -0.6990118 0.137 0.303 8.737252e-06\n#> RPS6       1.618619e-09 -0.1503779 1.000 1.000 9.339429e-06\n#> FTH1       1.872109e-09  0.4682722 0.985 0.979 1.080207e-05\n#> RNASET2    4.415456e-09  0.4433942 0.459 0.294 2.547718e-05\n#> JUN        6.181461e-09 -0.4842924 0.626 0.764 3.566703e-05\n#> MIF        1.030154e-08  0.4483803 0.447 0.281 5.943988e-05\n#> IGKC       1.435371e-08  0.4545000 0.350 0.175 8.282089e-05\n#> AC090498.1 1.468599e-08  0.4279242 0.662 0.518 8.473815e-05\n#> RPS3A      1.722304e-08  0.1391731 1.000 0.997 9.937696e-05\n#> DUSP1      4.892369e-08 -0.6420404 0.461 0.589 2.822897e-04\n#> FOS        6.224934e-08 -0.2758968 0.447 0.550 3.591787e-04\n#> SRGN       9.470426e-08  0.4988539 0.644 0.490 5.464436e-04\n#> RPL35A     1.521345e-07 -0.1073852 1.000 1.000 8.778158e-04\n#> EIF1       2.473518e-07  0.2473318 0.990 0.990 1.427220e-03\n#> TOMM7      4.709370e-07  0.3352710 0.967 0.932 2.717306e-03\n#> CDKN2D     5.682847e-07  0.3507790 0.161 0.077 3.279003e-03\n#> RPL34      6.612236e-07 -0.1291198 1.000 1.000 3.815260e-03\n#> RPL7       1.038812e-06 -0.1378494 0.999 1.000 5.993943e-03\n#> RPL21      1.221218e-06 -0.1367031 1.000 1.000 7.046429e-03\n#> SOCS3      1.428318e-06  0.4725668 0.282 0.143 8.241394e-03\n#> HCST       1.520262e-06 -0.3271970 0.593 0.666 8.771910e-03\n#>            was_altered   AveExpr\n#> RPS4Y1           FALSE 0.9202398\n#> RPS9             FALSE 3.5762744\n#> HLA-B            FALSE 3.0576721\n#> RPS4X            FALSE 4.1464346\n#> MT-CO1           FALSE 3.6496692\n#> IFITM1           FALSE 0.4033074\n#> CRIP1            FALSE 0.3850406\n#> CTSW             FALSE 0.3843436\n#> RPS6             FALSE 4.6712710\n#> FTH1             FALSE 3.0892897\n#> RNASET2          FALSE 0.6206306\n#> JUN              FALSE 1.6804090\n#> MIF              FALSE 0.5931893\n#> IGKC             FALSE 0.4192262\n#> AC090498.1       FALSE 1.0845500\n#> RPS3A            FALSE 4.3093665\n#> DUSP1            FALSE 1.1359541\n#> FOS              FALSE 1.0806135\n#> SRGN             FALSE 1.1299643\n#> RPL35A           FALSE 4.1170374\n#> EIF1             FALSE 3.1872508\n#> TOMM7            FALSE 2.4603419\n#> CDKN2D           FALSE 0.1775316\n#> RPL34            FALSE 4.9369487\n#> RPL7             FALSE 4.0209595\n#> RPL21            FALSE 4.9282558\n#> SOCS3            FALSE 0.3484458\n#> HCST             FALSE 1.2159835\ndplyr::filter(de_result_wilcox, was_altered == TRUE)\n#>                      p_val avg_log2FC pct.1 pct.2 p_val_adj\n#> SSU72         9.655274e-05 1.36281990 0.338 0.338 0.5571093\n#> FO538757.2    1.200221e-03 1.20415411 0.103 0.043 1.0000000\n#> AURKAIP1      2.211160e-02 1.16643695 0.219 0.207 1.0000000\n#> TNFRSF4       6.601041e-02 0.55608168 0.048 0.026 1.0000000\n#> ISG15         8.216535e-02 1.19360511 0.162 0.161 1.0000000\n#> UBE2J2        9.283448e-02 0.69838502 0.085 0.101 1.0000000\n#> CPTP          1.120441e-01 0.13296356 0.013 0.024 1.0000000\n#> NOC2L         1.344635e-01 0.83107706 0.092 0.070 1.0000000\n#> RP11-345P4.9  1.411112e-01 0.35268040 0.031 0.023 1.0000000\n#> ATAD3B        1.551214e-01 0.35376001 0.022 0.010 1.0000000\n#> MIB2          2.651396e-01 0.83758935 0.089 0.073 1.0000000\n#> ATAD3A        2.952490e-01 0.30026847 0.019 0.019 1.0000000\n#> MRPL20        2.967604e-01 1.06804937 0.176 0.177 1.0000000\n#> CDK11B        3.424970e-01 0.69024916 0.080 0.080 1.0000000\n#> CCNL2         4.205482e-01 0.74371725 0.070 0.062 1.0000000\n#> RP11-206L10.9 4.370370e-01 0.37788534 0.028 0.018 1.0000000\n#> SDF4          6.523233e-01 0.80646725 0.103 0.114 1.0000000\n#> TNFRSF18      6.887641e-01 0.19960131 0.019 0.016 1.0000000\n#> AP006222.2    7.795600e-01 0.06620052 0.007 0.013 1.0000000\n#> PUSL1         8.232570e-01 0.23937883 0.018 0.020 1.0000000\n#> ACAP3         8.877751e-01 0.32560006 0.027 0.031 1.0000000\n#> CPSF3L        9.748766e-01 0.72870621 0.073 0.063 1.0000000\n#>               was_altered    AveExpr\n#> SSU72                TRUE 0.73609990\n#> FO538757.2           TRUE 0.16860112\n#> AURKAIP1             TRUE 0.45191094\n#> TNFRSF4              TRUE 0.07923627\n#> ISG15                TRUE 0.35171536\n#> UBE2J2               TRUE 0.18979977\n#> CPTP                 TRUE 0.03572932\n#> NOC2L                TRUE 0.16932813\n#> RP11-345P4.9         TRUE 0.05591016\n#> ATAD3B               TRUE 0.03637473\n#> MIB2                 TRUE 0.17040047\n#> ATAD3A               TRUE 0.03975988\n#> MRPL20               TRUE 0.37428897\n#> CDK11B               TRUE 0.16470706\n#> CCNL2                TRUE 0.13617764\n#> RP11-206L10.9        TRUE 0.04904527\n#> SDF4                 TRUE 0.22599522\n#> TNFRSF18             TRUE 0.03778980\n#> AP006222.2           TRUE 0.01922010\n#> PUSL1                TRUE 0.04011121\n#> ACAP3                TRUE 0.05863448\n#> CPSF3L               TRUE 0.14041781\n\nggplot(de_result_wilcox, aes(x=AveExpr, y=avg_log2FC, col=p_val_adj < 0.05)) +\n  geom_point() +\n  geom_point(data=filter(de_result_wilcox, was_altered), pch=3, col='blue', size=5 ) +\n  scale_colour_manual(values=c('TRUE'=\"red\",'FALSE'=\"black\")) + \n  theme_bw() +\n  ggtitle(\"Wilcox Test\")"},{"path":"de.html","id":"seurat-negative-binomial","chapter":"13 Differential Expression","heading":"13.5 Seurat Negative binomial","text":"","code":"\nde_result_negbinom <- FindMarkers(hcabm40k.mini.c0, \n            ident.1 = 'fake_treat',\n            ident.2 = 'fake_control',\n            logfc.threshold = 0, # Give me ALL results\n            min.pct = 0,\n            test.use=\"negbinom\", # Choose a different test.\n            max.cells.per.ident = 300  # Downsample cells - purely for speed!\n            )\n# the  'DE' genes\nde_result_negbinom$was_altered <- rownames(de_result_negbinom  ) %in% altered_genes\n# Add average expression for plotting\nde_result_negbinom$AveExpr<- rowMeans(hcabm40k.mini.c0[[\"RNA\"]][rownames(de_result_negbinom),])\ndplyr::filter(de_result_negbinom, p_val_adj < 0.01)\n#>                   p_val avg_log2FC pct.1 pct.2    p_val_adj\n#> HLA-B      2.047505e-16  0.5093075 0.993 0.975 1.181410e-12\n#> RPS4Y1     9.220319e-16  0.9409962 0.642 0.166 5.320124e-12\n#> FTH1       4.122127e-14  0.5599551 0.985 0.979 2.378467e-10\n#> MT-CO1     2.236368e-13  0.3058330 0.999 0.997 1.290384e-09\n#> SSU72      3.830592e-13  0.8808677 0.338 0.338 2.210252e-09\n#> IFITM1     7.982292e-10  0.3351739 0.334 0.172 4.605783e-06\n#> AC090498.1 9.099402e-10  0.3261936 0.662 0.518 5.250355e-06\n#> EIF1       1.021725e-09  0.3541414 0.990 0.990 5.895351e-06\n#> MRPL20     1.028331e-09  0.5496668 0.176 0.177 5.933469e-06\n#> AURKAIP1   3.830185e-09  0.6647683 0.219 0.207 2.210016e-05\n#> CTSW       7.099455e-09 -0.3014240 0.137 0.303 4.096385e-05\n#> RORA       8.597786e-09  0.2094804 0.317 0.200 4.960923e-05\n#> RPS3A      9.919567e-09  0.2483989 1.000 0.997 5.723590e-05\n#> IGKC       2.511182e-08  0.2685946 0.350 0.175 1.448952e-04\n#> ISG15      2.611588e-08  0.7340390 0.162 0.161 1.506887e-04\n#> YBX1       1.149199e-07  0.2717224 0.811 0.740 6.630876e-04\n#> RPS29      2.591186e-07  0.2047796 1.000 1.000 1.495115e-03\n#> TOMM7      5.506108e-07  0.3565451 0.967 0.932 3.177024e-03\n#> CRIP1      7.204767e-07  0.4070023 0.334 0.141 4.157151e-03\n#> MIF        7.580686e-07  0.2625155 0.447 0.281 4.374056e-03\n#> PIK3R1     1.674552e-06  0.2849652 0.380 0.244 9.662163e-03\n#>            was_altered   AveExpr\n#> HLA-B            FALSE 3.0576721\n#> RPS4Y1           FALSE 0.9202398\n#> FTH1             FALSE 3.0892897\n#> MT-CO1           FALSE 3.6496692\n#> SSU72             TRUE 0.7360999\n#> IFITM1           FALSE 0.4033074\n#> AC090498.1       FALSE 1.0845500\n#> EIF1             FALSE 3.1872508\n#> MRPL20            TRUE 0.3742890\n#> AURKAIP1          TRUE 0.4519109\n#> CTSW             FALSE 0.3843436\n#> RORA             FALSE 0.4213283\n#> RPS3A            FALSE 4.3093665\n#> IGKC             FALSE 0.4192262\n#> ISG15             TRUE 0.3517154\n#> YBX1             FALSE 1.5858368\n#> RPS29            FALSE 4.7015768\n#> TOMM7            FALSE 2.4603419\n#> CRIP1            FALSE 0.3850406\n#> MIF              FALSE 0.5931893\n#> PIK3R1           FALSE 0.5447793\ndplyr::filter(de_result_negbinom, was_altered == TRUE)\n#>                      p_val avg_log2FC pct.1 pct.2\n#> SSU72         3.830592e-13 0.88086768 0.338 0.338\n#> MRPL20        1.028331e-09 0.54966680 0.176 0.177\n#> AURKAIP1      3.830185e-09 0.66476830 0.219 0.207\n#> ISG15         2.611588e-08 0.73403899 0.162 0.161\n#> FO538757.2    4.270919e-06 0.46934343 0.103 0.043\n#> MIB2          1.981006e-05 0.37997003 0.089 0.073\n#> SDF4          6.943732e-05 0.35856603 0.103 0.114\n#> NOC2L         1.089203e-04 0.35397478 0.092 0.070\n#> CCNL2         1.398323e-04 0.29017704 0.070 0.062\n#> CPSF3L        1.569471e-04 0.29655428 0.073 0.063\n#> CDK11B        3.110903e-04 0.31182109 0.080 0.080\n#> UBE2J2        3.732766e-03 0.29944875 0.085 0.101\n#> TNFRSF4       8.321390e-03 0.22340043 0.048 0.026\n#> ATAD3B        1.158760e-02 0.10913157 0.022 0.010\n#> RP11-345P4.9  1.208334e-02 0.13436316 0.031 0.023\n#> RP11-206L10.9 1.273706e-02 0.13734666 0.028 0.018\n#> PUSL1         3.745426e-02 0.07096771 0.018 0.020\n#> ATAD3A        6.269991e-02 0.08074940 0.019 0.019\n#> AP006222.2    2.039951e-01 0.02436154 0.007 0.013\n#> ACAP3         2.111349e-01 0.11018169 0.027 0.031\n#> CPTP          3.603234e-01 0.04136582 0.013 0.024\n#> TNFRSF18      5.724217e-01 0.07719596 0.019 0.016\n#>                  p_val_adj was_altered    AveExpr\n#> SSU72         2.210252e-09        TRUE 0.73609990\n#> MRPL20        5.933469e-06        TRUE 0.37428897\n#> AURKAIP1      2.210016e-05        TRUE 0.45191094\n#> ISG15         1.506887e-04        TRUE 0.35171536\n#> FO538757.2    2.464320e-02        TRUE 0.16860112\n#> MIB2          1.143041e-01        TRUE 0.17040047\n#> SDF4          4.006533e-01        TRUE 0.22599522\n#> NOC2L         6.284702e-01        TRUE 0.16932813\n#> CCNL2         8.068324e-01        TRUE 0.13617764\n#> CPSF3L        9.055851e-01        TRUE 0.14041781\n#> CDK11B        1.000000e+00        TRUE 0.16470706\n#> UBE2J2        1.000000e+00        TRUE 0.18979977\n#> TNFRSF4       1.000000e+00        TRUE 0.07923627\n#> ATAD3B        1.000000e+00        TRUE 0.03637473\n#> RP11-345P4.9  1.000000e+00        TRUE 0.05591016\n#> RP11-206L10.9 1.000000e+00        TRUE 0.04904527\n#> PUSL1         1.000000e+00        TRUE 0.04011121\n#> ATAD3A        1.000000e+00        TRUE 0.03975988\n#> AP006222.2    1.000000e+00        TRUE 0.01922010\n#> ACAP3         1.000000e+00        TRUE 0.05863448\n#> CPTP          1.000000e+00        TRUE 0.03572932\n#> TNFRSF18      1.000000e+00        TRUE 0.03778980\nggplot(de_result_negbinom, aes(x=AveExpr, y=avg_log2FC, col=p_val_adj < 0.05)) +\n  geom_point() +\n  geom_point(data=filter(de_result_negbinom, was_altered), pch=3, col='blue', size=5 ) +\n  scale_colour_manual(values=c('TRUE'=\"red\",'FALSE'=\"black\")) + \n  theme_bw() +\n  ggtitle(\"Wilcox Test\")"},{"path":"de.html","id":"pseudobulk","chapter":"13 Differential Expression","heading":"13.6 Pseudobulk","text":"Pseudobulk analysis option biological replicates. essentially pooling individual cell counts treating expreiment like bulk RNAseq.First, need build pseudobulk matrix - AggregateExpression() function can , set ‘Idents’ seurat object grouping factor (, sample instead cluster).Now looks like bulk RNAseq experiment, treat like one.","code":"\n# Tools for bulk differential expression\nlibrary(limma)\n#> Warning: package 'limma' was built under R version 4.1.3\n#> \n#> Attaching package: 'limma'\n#> The following object is masked from 'package:BiocGenerics':\n#> \n#>     plotMA\nlibrary(edgeR)\n#> Warning: package 'edgeR' was built under R version 4.1.1\n#> \n#> Attaching package: 'edgeR'\n#> The following object is masked from 'package:SingleCellExperiment':\n#> \n#>     cpm\n\n\n# Change idents to sample fro grouping.\nIdents(hcabm40k.mini.c0) <- hcabm40k.mini.c0$orig.ident\n\n\npseudobulk_matrix <- AggregateExpression( hcabm40k.mini.c0,  slot = 'counts', assays='RNA' )[['RNA']]\npseudobulk_matrix[1:5,]\n#>               MantonBM1 MantonBM2 MantonBM3 MantonBM4\n#> FO538757.2           52        88       116        44\n#> AP006222.2            4         4         4         8\n#> RP11-206L10.9        20         4        36        20\n#> NOC2L                64        72        52        60\n#> ISG15               280       204        72       112\n#>               MantonBM5 MantonBM6 MantonBM7 MantonBM8\n#> FO538757.2            5         9        10        12\n#> AP006222.2            0         5         3         2\n#> RP11-206L10.9         8         2         3         1\n#> NOC2L                 6        23        15        13\n#> ISG15                18        55        50        36\ndge <- DGEList(pseudobulk_matrix)\ndge <- calcNormFactors(dge)\n\ncondition <- factor(condition_lookup[colnames(pseudobulk_matrix)])\ndesign <- model.matrix(~condition)\nvm  <- voom(dge, design = design, plot = FALSE)\nfit <- lmFit(vm, design = design)\nfit <- eBayes(fit)\nde_result_pseudobulk <- topTable(fit, n = Inf, adjust.method = \"BH\")\n#> Removing intercept from test coefficients\nde_result_pseudobulk <- arrange(de_result_pseudobulk , adj.P.Val)\nde_result_pseudobulk$was_altered <- rownames(de_result_pseudobulk ) %in% altered_genes\n\nfilter(de_result_pseudobulk,    adj.P.Val < 0.05)\n#>                logFC  AveExpr         t      P.Value\n#> SSU72       1.827399 8.223682  8.692304 2.860363e-07\n#> MIB2        2.218842 5.995477  8.521901 3.678808e-07\n#> FO538757.2  3.053688 5.683244  8.065974 7.337060e-07\n#> AURKAIP1    1.874062 7.448062  7.552436 1.646799e-06\n#> NOC2L       2.256402 5.873625  7.284448 2.545248e-06\n#> CCNL2       2.009855 5.594008  6.417440 1.112005e-05\n#> TNFRSF4     2.686188 4.857853  5.918920 2.719907e-05\n#> MRPL20      1.741288 7.140368  5.724222 3.892940e-05\n#> ISG15       2.072292 7.231757  5.487119 6.066165e-05\n#> CTSW       -1.519444 6.533752 -5.497693 5.946401e-05\n#> CPSF3L      2.083187 5.672812  5.308804 8.509637e-05\n#>              adj.P.Val        B was_altered\n#> SSU72      0.001061336 6.667334        TRUE\n#> MIB2       0.001061336 5.647051        TRUE\n#> FO538757.2 0.001411161 4.797357        TRUE\n#> AURKAIP1   0.002375507 5.052546        TRUE\n#> NOC2L      0.002937216 4.182797        TRUE\n#> CCNL2      0.010693783 2.999551        TRUE\n#> TNFRSF4    0.022419804 1.872900        TRUE\n#> MRPL20     0.028077829 2.321087        TRUE\n#> ISG15      0.035001771 1.936264        TRUE\n#> CTSW       0.035001771 1.887985       FALSE\n#> CPSF3L     0.044636914 1.425176        TRUE\nfilter(de_result_pseudobulk, was_altered == TRUE)\n#>                  logFC  AveExpr        t      P.Value\n#> SSU72         1.827399 8.223682 8.692304 2.860363e-07\n#> MIB2          2.218842 5.995477 8.521901 3.678808e-07\n#> FO538757.2    3.053688 5.683244 8.065974 7.337060e-07\n#> AURKAIP1      1.874062 7.448062 7.552436 1.646799e-06\n#> NOC2L         2.256402 5.873625 7.284448 2.545248e-06\n#> CCNL2         2.009855 5.594008 6.417440 1.112005e-05\n#> TNFRSF4       2.686188 4.857853 5.918920 2.719907e-05\n#> MRPL20        1.741288 7.140368 5.724222 3.892940e-05\n#> ISG15         2.072292 7.231757 5.487119 6.066165e-05\n#> CPSF3L        2.083187 5.672812 5.308804 8.509637e-05\n#> CDK11B        1.695361 5.867293 4.694290 2.816049e-04\n#> SDF4          1.668179 6.351442 4.416104 4.908440e-04\n#> ATAD3B        2.481897 3.445121 3.786880 1.766296e-03\n#> UBE2J2        1.575101 6.034639 3.464531 3.428952e-03\n#> PUSL1         1.533289 3.903357 3.311507 4.699198e-03\n#> RP11-206L10.9 2.514828 3.884651 3.221094 5.659663e-03\n#> ACAP3         1.461375 4.360386 2.735278 1.524241e-02\n#> ATAD3A        1.767874 3.708504 2.648575 1.814391e-02\n#> AP006222.2    1.233790 2.798325 1.987226 6.531280e-02\n#> CPTP          1.043158 3.641585 1.831192 8.683604e-02\n#> TNFRSF18      1.439378 3.432145 1.578657 1.350916e-01\n#> RP11-345P4.9  1.400079 3.700624 1.425998 1.741766e-01\n#>                 adj.P.Val           B was_altered\n#> SSU72         0.001061336  6.66733411        TRUE\n#> MIB2          0.001061336  5.64705060        TRUE\n#> FO538757.2    0.001411161  4.79735742        TRUE\n#> AURKAIP1      0.002375507  5.05254647        TRUE\n#> NOC2L         0.002937216  4.18279685        TRUE\n#> CCNL2         0.010693783  2.99955073        TRUE\n#> TNFRSF4       0.022419804  1.87290007        TRUE\n#> MRPL20        0.028077829  2.32108741        TRUE\n#> ISG15         0.035001771  1.93626353        TRUE\n#> CPSF3L        0.044636914  1.42517599        TRUE\n#> CDK11B        0.132566905  0.49038317        TRUE\n#> SDF4          0.188811316  0.05370517        TRUE\n#> ATAD3B        0.536396233 -1.52858995        TRUE\n#> UBE2J2        0.732779678 -1.64433325        TRUE\n#> PUSL1         0.821647586 -2.04781451        TRUE\n#> RP11-206L10.9 0.933035863 -2.22812984        TRUE\n#> ACAP3         0.997887502 -2.87920934        TRUE\n#> ATAD3A        0.997887502 -3.04649462        TRUE\n#> AP006222.2    0.997887502 -3.92807988        TRUE\n#> CPTP          0.997887502 -4.13957382        TRUE\n#> TNFRSF18      0.997887502 -4.41616654        TRUE\n#> RP11-345P4.9  0.997887502 -4.61353678        TRUE\nggplot(de_result_pseudobulk, aes(x=AveExpr, y=logFC, col=adj.P.Val < 0.05)) +\n  geom_point() +\n  geom_point(data=filter(de_result_pseudobulk, was_altered), pch=3, col='blue', size=5 ) +\n  scale_colour_manual(values=c('TRUE'=\"red\",'FALSE'=\"black\")) + \n  theme_bw() +\n  ggtitle(\"Pseudobulk\")"},{"path":"de.html","id":"challenge-what-method","chapter":"13 Differential Expression","heading":"Challenge: What method?","text":"methods give different results. decide use? check individual gene?","code":""},{"path":"finishing-up.html","id":"finishing-up","chapter":"14 Finishing up","heading":"14 Finishing up","text":"","code":""},{"path":"resources.html","id":"resources","chapter":"15 Resources","heading":"15 Resources","text":"Useful resources next steps.Many Seurat Vignettes: https://satijalab.org/seurat/index.htmlMany Seurat Vignettes: https://satijalab.org/seurat/index.htmlOchestrating Single Cell Analysis bioconductor: https://bioconductor.org/books/release/OSCA/Ochestrating Single Cell Analysis bioconductor: https://bioconductor.org/books/release/OSCA/Bunch useful links listed : https://monashbioinformaticsplatform.github.io/Single-Cell-Workshop/Bunch useful links listed : https://monashbioinformaticsplatform.github.io/Single-Cell-Workshop/TidySeuratTidySeuratDemo 10X data - variations technolgy; https://www.10xgenomics.com/resources/datasetsDemo 10X data - variations technolgy; https://www.10xgenomics.com/resources/datasetsSeurat command cheat sheet. ’re trying figure find something object: https://satijalab.org/seurat/articles/essential_commands.htmlhttps://satijalab.org/seurat/archive/v3.1/de_vignette.html Differential expresison SEurat.tidyversesingleR\ncelldex\nlibrary(SingleCellExperiment)\nlibrary(SingleR)\nlibrary(celldex)monocle: (done.)\nremotes::install_github(‘satijalab/seurat-wrappers’)\nonfigure: error: gdal-config found executable.\nremotes::install_github(‘rspatial/terra’)\ndevtools::install_github(‘cole-trapnell-lab/monocle3’)","code":""},{"path":"references.html","id":"references","chapter":"References","heading":"References","text":"","code":""}]
